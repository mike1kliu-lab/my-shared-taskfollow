<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>任务追踪表格（分页 + 可编辑 + 自定义横向滚动条）</title>
<style>
    *{
        box-sizing:border-box;
        margin:0;
        padding:0;
        font-family:"Segoe UI","Microsoft YaHei",sans-serif;
    }
    body{
        background:#121212;
        padding:20px;
        color:#e0e0e0;
    }
    .container{
        max-width:1200px;
        margin:auto;
    }
    h1{
        text-align:center;
        margin-bottom:20px;
        font-size:28px;
    }
    .instructions{
        background:#1e1e1e;
        padding:15px;
        border-radius:8px;
        margin-bottom:20px;
        border-left:4px solid #2196f3;
    }
    .instructions h2{margin-bottom:10px;color:#4fc3f7;}
    .instructions li{margin-bottom:8px;color:#bbbbbb;}
    .table-wrapper{
        position:relative;
        margin-bottom:20px;
    }
    .table-container{
        overflow-x:auto;
        background:#1e1e1e;
        border-radius:10px;
        box-shadow:0 4px 12px rgba(0,0,0,.5);
        padding:20px;
    }
    table{
        width:100%;
        border-collapse:collapse;
        min-width:800px;
    }
    th{
        background:#2c3e50;
        color:#fff;
        padding:15px 10px;
        text-align:center;
        cursor:pointer;
        transition:bg .3s;
        border-bottom:1px solid #333;
    }
    th:hover{background:#34495e;}
    .task-cell{
        border:1px solid #333;
        padding:12px;
        position:relative;
        background:#2b2b2b;
        transition:bg .2s;
    }
    .task-cell:hover{background:#333;}
    .sub-task-cell{
        border:1px solid #444;
        padding:12px;
        position:relative;
        background:#333;
        transition:bg .2s;
    }
    .sub-task-cell:hover{background:#3a3a3a;}
    .status-indicator{
        position:absolute;
        top:8px;
        right:8px;
        width:16px;
        height:16px;
        border-radius:3px;
        z-index:2;
    }
    .status-green{background:#4CAF50;}
    .status-yellow{background:#FFC107;}
    .status-red{background:#F44336;}
    .cell-controls{
        position:absolute;
        top:30px;
        right:8px;
        display:flex;
        gap:4px;
        z-index:3;
    }
    .add-cell-btn,.delete-cell-btn{
        width:24px;height:24px;
        border:none;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        font-weight:bold;
        font-size:14px;
        transition:all .2s;
    }
    .add-cell-btn{
        background:#4CAF50;color:#fff;
    }
    .add-cell-btn:hover{background:#388E3C;}
    .delete-cell-btn{
        background:#F44318;color:#fff;
    }
    .delete-cell-btn:hover{background:#D32F2F;}
    .checkbox-container{
        position:absolute;
        top:8px;
        left:8px;
        z-index:2;
    }
    .task-checkbox{
        width:18px;height:18px;
        cursor:pointer;
    }
    .cell-content{
        padding:30px 40px 0 30px;
        word-break:break-word;
        line-height:1.4;
    }
    .sub-cell-content{
        margin-left:2ch;
        padding:12px 0 0 0;
        word-break:break-word;
        line-height:1.4;
    }
    .cell-input,
    .sub-cell-input{
        width:100%;
        min-height:24px;
        border:none;
        outline:none;
        background:transparent;
        color:#e0e0e0;
        font-family:inherit;
        font-size:inherit;
        white-space:pre-wrap;
        word-break:break-word;
    }
    .cell-input::placeholder,
    .sub-cell-input::placeholder{
        color:#777;
    }
    .expand-indicator{
        width:24px;height:24px;
        border-radius:50%;
        background:#2196F3;color:#fff;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        font-weight:bold;
        font-size:16px;
        transition:all .2s;
    }
    .expand-indicator:hover{
        background:#0b7dda;
        transform:scale(1.1);
    }
    .legend{
        display:flex;
        justify-content:center;
        gap:20px;
        margin-top:20px;
        flex-wrap:wrap;
    }
    .legend-item{display:flex;align-items:center;gap:8px;}
    .legend-color{
        width:20px;height:20px;
        border-radius:3px;
    }
    .actions{
        display:flex;
        justify-content:center;
        gap:15px;
        margin-top:20px;
    }
    .pagination{
        display:flex;
        justify-content:center;
        align-items:center;
        gap:12px;
        margin-top:15px;
    }
    .pagination button{
        width:36px;height:36px;
        border:none;
        border-radius:6px;
        background:#2196F3;
        color:#fff;
        font-size:20px;
        cursor:pointer;
        transition:background .2s;
    }
    .pagination button:hover{background:#0b7dda;}
    .pagination button:disabled{
        background:#555;
        cursor:not-allowed;
    }
    button{
        padding:10px 20px;
        border:none;
        border-radius:6px;
        cursor:pointer;
        font-weight:600;
        transition:all .2s;
        color:#fff;
    }
    .add-task-btn{background:#2196F3;}
    .add-task-btn:hover{background:#0b7dda;}
    .reset-btn{background:#9E9E9E;}
    .reset-btn:hover{background:#757575;}
    .empty-cell{
        border:1px solid #333;
        background:#2b2b2b;
    }
    .scrollbar{
        height:12px;
        margin-top:8px;
        user-select:none;
    }
    .scrollbar .track{
        width:100%;
        height:8px;
        background:#444;
        border-radius:4px;
        position:relative;
        cursor:pointer;
    }
    .scrollbar .thumb{
        height:100%;
        width:60px;
        background:#2196F3;
        border-radius:4px;
        position:absolute;
        left:0;
        top:0;
        cursor:pointer;
        transition:background .2s;
    }
    .scrollbar .thumb:hover{
        background:#0b7dda;
    }
    @media(max-width:768px){
        .table-container{padding:10px;}
        th,.task-cell,.sub-task-cell{padding:10px 5px;}
        .cell-content,.sub-cell-content{font-size:14px;padding:30px 40px 0 30px;}
    }
</style>
</head>
<body>
<div class="container">
    <h1>任务追踪表格</h1>

    <div class="instructions">
        <h2>使用说明</h2>
        <ul>
            <li><strong>点击文字即可编辑</strong>（回车换行），失焦后自动保存</li>
            <li><strong>勾选复选框</strong>：锁定任务状态（保持绿色）</li>
            <li><strong>点击表头</strong>：只显示该列任务</li>
            <li><strong>点击左侧三角</strong>：展开子任务列（右侧出现新列，其他列整体右移）</li>
            <li><strong>状态指示灯</strong>：绿色&lt;12 h，黄色&lt;24 h，红色≥24 h</li>
            <li><strong>拖动下方进度条</strong>即可横向滚动表格，且不会遮挡任何内容</li>
            <li><strong>分页</strong>：每页最多显示 3 项目，使用「-」/「+」切换</li>
        </ul>
    </div>

    <div class="table-wrapper">
        <div class="table-container" id="tableContainer">
            <table id="taskTable">
                <thead><tr id="headerRow"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <!-- 自定义水平滚动条 -->
        <div class="scrollbar" id="customScrollbar">
            <div class="track"><div class="thumb" id="scrollThumb"></div></div>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background:#4CAF50;"></div><span>&lt;12 h</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#FFC107;"></div><span>&lt;24 h</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#F44336;"></div><span>≥24 h</span></div>
    </div>

    <div class="actions">
        <button class="add-task-btn" onclick="addNewTask()">+ 添加新任务</button>
        <button class="reset-btn" onclick="resetView()">重置视图</button>
    </div>

    <!-- 分页控制 -->
    <div class="pagination">
        <button class="prev-page-btn" onclick="prevPage()">−</button>
        <span id="pageInfo">第 1 / 1 页</span>
        <button class="next-page-btn" onclick="nextPage()">+</button>
    </div>
</div>

<script>
/* -------------------- 数据模型 -------------------- */
let tasks = [
    {
        name:"项目A",
        cells:[
            {content:"完成需求分析",completed:false,lastUpdated:new Date(Date.now()-2*60*60*1000),expanded:false,subCells:[]},
            {content:"设计系统架构",completed:true,lastUpdated:new Date(Date.now()-5*60*60*1000),expanded:false,subCells:[]}
        ]
    },
    {
        name:"项目B",
        cells:[
            {content:"编写核心模块",completed:false,lastUpdated:new Date(Date.now()-15*60*60*1000),expanded:false,subCells:[]},
            {content:"单元测试",completed:false,lastUpdated:new Date(Date.now()-30*60*60*1000),expanded:false,subCells:[]}
        ]
    },
    {
        name:"日常任务",
        cells:[
            {content:"代码审查",completed:true,lastUpdated:new Date(Date.now()-8*60*60*1000),expanded:false,subCells:[]},
            {content:"团队会议",completed:false,lastUpdated:new Date(Date.now()-10*60*60*1000),expanded:false,subCells:[]}
        ]
    }
];

let expandedColumnIdx = null;   // 当前展开的主任务列（若有）
let expandedCellIdx   = null;   // 对应的主任务单元格索引
let currentTaskFilter = null;   // null → 显示全部
let currentPage = 0;            // 当前分页（从 0 开始计数）
const tasksPerPage = 3;         // 每页最多显示的项目数

/* -------------------- 初始化 -------------------- */
function initTable(){
    renderTable();
    updateStatusIndicators();
    setInterval(updateStatusIndicators,30000);   // 每 30 s 更新颜色
    initCustomScrollbar();                      // 为横向滚动条绑定事件
    updatePaginationInfo();
}
document.addEventListener('DOMContentLoaded',initTable);

/* -------------------- 渲染 -------------------- */
function renderTable(){
    const headerRow = document.getElementById('headerRow');
    const tbody    = document.getElementById('tableBody');
    headerRow.innerHTML = '';
    tbody.innerHTML    = '';

    /* ----- 计算可见列（分页或过滤） ----- */
    let visibleIndices;
    if(currentTaskFilter !== null){
        // 只显示单个被过滤的列
        visibleIndices = [currentTaskFilter];
    }else{
        const start = currentPage * tasksPerPage;
        const end   = start + tasksPerPage;
        visibleIndices = tasks.map((_,i)=>i).slice(start,end);
    }

    /* ----- 列顺序：主列 +（若展开）子任务列 ----- */
    const colOrder = [];
    visibleIndices.forEach(idx=>{
        colOrder.push(idx);                // 主任务列
        if(expandedColumnIdx!==null && expandedColumnIdx===idx){
            colOrder.push(`sub-${idx}`); // 对应的子任务列
        }
    });

    /* ----- 表头 ----- */
    colOrder.forEach(col=>{
        const th=document.createElement('th');
        if(typeof col==='number'){
            th.textContent = tasks[col].name;
            if(currentTaskFilter!==null) th.onclick = resetView;
            else th.onclick = ()=>filterTask(col);
        }else{
            th.textContent = tasks[expandedColumnIdx].name + ' 子任务';
            th.onclick = resetView;
        }
        headerRow.appendChild(th);
    });

    /* ----- 计算主任务最大行数（用于循环） ----- */
    let maxMainRows = 0;
    visibleIndices.forEach(i=> maxMainRows = Math.max(maxMainRows, tasks[i].cells.length));

    /* ----- 按行渲染：主任务行 →（若展开）子任务行 ----- */
    for(let mainRowIdx=0; mainRowIdx<maxMainRows; mainRowIdx++){
        /* 主任务行 */
        const trMain=document.createElement('tr');
        colOrder.forEach(col=>{
            let td;
            if(typeof col==='number'){
                const task = tasks[col];
                const cell = task.cells[mainRowIdx];
                td = cell ? createMainTaskCell(cell,col,mainRowIdx)
                         : (function(){ const d=document.createElement('td'); d.className='empty-cell'; return d; })();
            }else{
                td = document.createElement('td');   // 子任务列在主任务行里保持空白
                td.className='empty-cell';
            }
            trMain.appendChild(td);
        });
        tbody.appendChild(trMain);

        /* 子任务行（仅在展开列对应且该单元格已展开时出现） */
        if(expandedColumnIdx!==null && visibleIndices.includes(expandedColumnIdx)){
            const expTask = tasks[expandedColumnIdx];
            const expCell = expTask.cells[mainRowIdx];
            if(expCell && expCell.expanded && expCell.subCells.length>0){
                expCell.subCells.forEach((subCell,subIdx)=>{
                    const trSub=document.createElement('tr');
                    colOrder.forEach(col=>{
                        let td;
                        if(typeof col==='number'){
                            td = document.createElement('td');
                            td.className='empty-cell';
                        }else{
                            td = createSubTaskCell(subCell,expandedColumnIdx,mainRowIdx,subIdx);
                        }
                        trSub.appendChild(td);
                    });
                    tbody.appendChild(trSub);
                });
            }
        }
    }

    // 完成渲染后同步滚动条尺寸/位置
    updateScrollbar();
    // 同步分页按钮状态
    updatePaginationInfo();
}

/* -------------------- 主任务单元格（可编辑） -------------------- */
function createMainTaskCell(cell,taskIdx,cellIdx){
    const td=document.createElement('td');
    td.className='task-cell';

    /* 复选框 */
    const cbDiv=document.createElement('div');
    cbDiv.className='checkbox-container';
    const cb=document.createElement('input');
    cb.type='checkbox';
    cb.className='task-checkbox';
    cb.checked=cell.completed;
    cb.onchange=()=>toggleCompleted(taskIdx,cellIdx);
    cbDiv.appendChild(cb);
    td.appendChild(cbDiv);

    /* 状态指示灯 */
    const status=document.createElement('div');
    status.className='status-indicator';
    status.id=`status-${taskIdx}-${cellIdx}`;
    td.appendChild(status);

    /* 控制按钮（展开 / 添加 / 删除） */
    const ctrl=document.createElement('div');
    ctrl.className='cell-controls';

    // 展开/收起指示器（左侧）
    const expand=document.createElement('div');
    expand.className='expand-indicator';
    expand.textContent=cell.expanded?'▲':'▼';
    expand.title=cell.expanded?'收起子任务':'展开子任务';
    expand.onclick=e=>{ e.stopPropagation(); toggleSubCells(taskIdx,cellIdx); };
    ctrl.appendChild(expand);

    // 添加按钮
    const addBtn=document.createElement('button');
    addBtn.className='add-cell-btn';
    addBtn.textContent='+';
    addBtn.onclick=e=>{ e.stopPropagation(); addCellBelow(taskIdx,cellIdx); };
    ctrl.appendChild(addBtn);

    // 删除按钮
    const delBtn=document.createElement('button');
    delBtn.className='delete-cell-btn';
    delBtn.textContent='×';
    delBtn.onclick=e=>{ e.stopPropagation(); if(confirm('确定要删除此任务单元格吗？')) deleteCell(taskIdx,cellIdx); };
    ctrl.appendChild(delBtn);
    td.appendChild(ctrl);

    /* 内容（contenteditable） */
    const contentDiv=document.createElement('div');
    contentDiv.className='cell-content';
    const editable=document.createElement('div');
    editable.className='cell-input';
    editable.contentEditable='true';
    editable.innerText = cell.content;
    editable.title='直接编辑，回车换行，失焦自动保存';
    // 保存逻辑（blur）
    const save=()=>{
        const v=editable.innerText.trimEnd();
        if(v!==''){
            cell.content=v;
            cell.lastUpdated=new Date();
        }else{
            // 防止把内容删空
            editable.innerText = cell.content;
        }
        updateStatusIndicators();
    };
    editable.addEventListener('blur',save);
    contentDiv.appendChild(editable);
    td.appendChild(contentDiv);

    return td;
}

/* -------------------- 子任务单元格（可编辑） -------------------- */
function createSubTaskCell(subCell,taskIdx,parentCellIdx,subIdx){
    const td=document.createElement('td');
    td.className='sub-task-cell';

    /* 复选框 */
    const cbDiv=document.createElement('div');
    cbDiv.className='checkbox-container';
    const cb=document.createElement('input');
    cb.type='checkbox';
    cb.className='task-checkbox';
    cb.checked=subCell.completed;
    cb.onchange=()=>toggleSubCompleted(taskIdx,parentCellIdx,subIdx);
    cbDiv.appendChild(cb);
    td.appendChild(cbDiv);

    /* 状态指示灯 */
    const status=document.createElement('div');
    status.className='status-indicator';
    status.id=`status-${taskIdx}-${parentCellIdx}-sub${subIdx}`;
    td.appendChild(status);

    /* 控制按钮（添加 / 删除） */
    const ctrl=document.createElement('div');
    ctrl.className='cell-controls';

    const addBtn=document.createElement('button');
    addBtn.className='add-cell-btn';
    addBtn.textContent='+';
    addBtn.onclick=e=>{ e.stopPropagation(); addSubCellBelow(taskIdx,parentCellIdx,subIdx); };
    ctrl.appendChild(addBtn);

    const delBtn=document.createElement('button');
    delBtn.className='delete-cell-btn';
    delBtn.textContent='×';
    delBtn.onclick=e=>{ e.stopPropagation(); if(confirm('确定要删除此子任务吗？')) deleteSubCell(taskIdx,parentCellIdx,subIdx); };
    ctrl.appendChild(delBtn);
    td.appendChild(ctrl);

    /* 内容（contenteditable） */
    const contentDiv=document.createElement('div');
    contentDiv.className='sub-cell-content';
    const editable=document.createElement('div');
    editable.className='sub-cell-input';
    editable.contentEditable='true';
    editable.innerText=subCell.content;
    editable.title='直接编辑，回车换行，失焦自动保存';
    const save=()=>{
        const v=editable.innerText.trimEnd();
        if(v!==''){
            subCell.content=v;
            subCell.lastUpdated=new Date();
        }else{
            editable.innerText=subCell.content;
        }
        updateStatusIndicators();
    };
    editable.addEventListener('blur',save);
    contentDiv.appendChild(editable);
    td.appendChild(contentDiv);

    /* 已去掉子任务右下角的 “新增子任务” 小三角 */

    return td;
}

/* -------------------- 交互函数 -------------------- */
function toggleCompleted(ti,ci){
    const cell=tasks[ti].cells[ci];
    cell.completed=!cell.completed;
    renderTable();
    updateStatusIndicators();
}
function toggleSubCompleted(ti,pi,si){
    const sub=tasks[ti].cells[pi].subCells[si];
    sub.completed=!sub.completed;
    renderTable();
    updateStatusIndicators();
}
function addCellBelow(ti,ci){
    const newCell={content:'新任务',completed:false,lastUpdated:new Date(),expanded:false,subCells:[]};
    tasks[ti].cells.splice(ci+1,0,newCell);
    renderTable();
    updateStatusIndicators();
}
function addSubCellBelow(ti,pi,si){
    const newSub={content:'新子任务',completed:false,lastUpdated:new Date()};
    tasks[ti].cells[pi].subCells.splice(si+1,0,newSub);
    renderTable();
    updateStatusIndicators();
}
function deleteCell(ti,ci){
    tasks[ti].cells.splice(ci,1);
    if(expandedColumnIdx===ti && expandedCellIdx===ci){
        expandedColumnIdx=null;
        expandedCellIdx=null;
    }
    renderTable();
    updateStatusIndicators();
}
function deleteSubCell(ti,pi,si){
    tasks[ti].cells[pi].subCells.splice(si,1);
    renderTable();
    updateStatusIndicators();
}

/* 展开/收起子任务列（同一时间只能有一个子任务列） */
function toggleSubCells(ti,ci){
    const cell=tasks[ti].cells[ci];
    const willExpand=!cell.expanded;

    // 关闭上一次展开的列（若不是同一个单元格）
    if(expandedColumnIdx!==null && (expandedColumnIdx!==ti || expandedCellIdx!==ci)){
        const prevCell=tasks[expandedColumnIdx].cells[expandedCellIdx];
        if(prevCell) prevCell.expanded=false;
        expandedColumnIdx=null;
        expandedCellIdx=null;
    }

    if(willExpand){
        if(cell.subCells.length===0){
            cell.subCells.push({content:'子任务',completed:false,lastUpdated:new Date()});
        }
        cell.expanded=true;
        expandedColumnIdx=ti;
        expandedCellIdx=ci;
    }else{
        cell.expanded=false;
        expandedColumnIdx=null;
        expandedCellIdx=null;
    }
    renderTable();
    updateStatusIndicators();
}

/* ---------- 过滤视图 ---------- */
function filterTask(idx){
    currentTaskFilter=idx;
    renderTable();
}
function resetView(){
    currentTaskFilter=null;
    renderTable();
}

/* ---------- 添加新任务（新列） ---------- */
function addNewTask(){
    const name=prompt('输入新任务名称:');
    if(name && name.trim()){
        tasks.push({
            name:name.trim(),
            cells:[{content:'新任务项',completed:false,lastUpdated:new Date(),expanded:false,subCells:[]}]
        });
        renderTable();
        updateStatusIndicators();
    }
}

/* ---------- 状态指示灯颜色更新 ---------- */
function updateStatusIndicators(){
    const now=Date.now();
    tasks.forEach((task,tIdx)=>{
        task.cells.forEach((cell,cIdx)=>{
            const st=document.getElementById(`status-${tIdx}-${cIdx}`);
            if(st){
                if(cell.completed){
                    st.className='status-indicator status-green';
                }else{
                    const diff=(now-cell.lastUpdated)/(1000*60*60);
                    st.className= diff<12?'status-indicator status-green':
                                 diff<24?'status-indicator status-yellow':
                                         'status-indicator status-red';
                }
            }
            // 子任务颜色
            cell.subCells.forEach((sub,sIdx)=>{
                const sst=document.getElementById(`status-${tIdx}-${cIdx}-sub${sIdx}`);
                if(sst){
                    if(sub.completed){
                        sst.className='status-indicator status-green';
                    }else{
                        const diff=(now-sub.lastUpdated)/(1000*60*60);
                        sst.className= diff<12?'status-indicator status-green':
                                     diff<24?'status-indicator status-yellow':
                                             'status-indicator status-red';
                    }
                }
            });
        });
    });
}

/* -------------------- 自定义横向滚动条 -------------------- */
function initCustomScrollbar(){
    const thumb=document.getElementById('scrollThumb');
    const track=document.querySelector('#customScrollbar .track');
    const container=document.getElementById('tableContainer');

    let isDragging=false;
    let startX=0;
    let startLeft=0;

    // 拖动 thumb
    thumb.addEventListener('mousedown',e=>{
        e.preventDefault();
        isDragging=true;
        startX=e.pageX;
        const m=thumb.style.transform.match(/translateX\(([^)]+)px\)/);
        startLeft=m?parseFloat(m[1]):0;
        document.body.classList.add('no-select');
    });
    document.addEventListener('mousemove',e=>{
        if(!isDragging) return;
        const dx=e.pageX-startX;
        const trackWidth=track.clientWidth;
        const maxThumbLeft=trackWidth-thumb.offsetWidth;
        let newLeft=startLeft+dx;
        newLeft=Math.max(0,Math.min(newLeft,maxThumbLeft));
        thumb.style.transform=`translateX(${newLeft}px)`;

        // 同步容器滚动
        const maxScroll=container.scrollWidth-container.clientWidth;
        const scrollLeft=(newLeft/maxThumbLeft)*maxScroll;
        container.scrollLeft=scrollLeft;
    });
    document.addEventListener('mouseup',()=>{
        if(isDragging){
            isDragging=false;
            document.body.classList.remove('no-select');
        }
    });

    // 点击轨道跳转
    track.addEventListener('click',e=>{
        if(isDragging) return;
        const rect=track.getBoundingClientRect();
        const clickX=e.clientX-rect.left;
        const thumbWidth=thumb.offsetWidth;
        const trackWidth=track.clientWidth;
        const maxThumbLeft=trackWidth-thumbWidth;
        let newLeft=clickX-thumbWidth/2;
        newLeft=Math.max(0,Math.min(newLeft,maxThumbLeft));
        thumb.style.transform=`translateX(${newLeft}px)`;
        const maxScroll=container.scrollWidth-container.clientWidth;
        const scrollLeft=(newLeft/maxThumbLeft)*maxScroll;
        container.scrollLeft=scrollLeft;
    });
}

/* 根据容器滚动同步 thumb 大小/位置 */
function updateScrollbar(){
    const container=document.getElementById('tableContainer');
    const thumb=document.getElementById('scrollThumb');
    const track=document.querySelector('#customScrollbar .track');

    const scrollWidth=container.scrollWidth;
    const clientWidth=container.clientWidth;

    if(scrollWidth<=clientWidth){
        thumb.style.display='none';
        return;
    }else{
        thumb.style.display='block';
    }

    const ratio=clientWidth/scrollWidth;
    const thumbWidth=Math.max(ratio*track.clientWidth,30);
    thumb.style.width=thumbWidth+'px';

    const maxScroll=scrollWidth-clientWidth;
    const maxThumbLeft=track.clientWidth-thumbWidth;
    const left=(container.scrollLeft/maxScroll)*maxThumbLeft;
    thumb.style.transform=`translateX(${left}px)`;
}

/* -------------------- 分页控制 -------------------- */
function nextPage(){
    if(currentTaskFilter!==null) return; // 过滤状态下不分页
    const totalPages=Math.ceil(tasks.length/tasksPerPage);
    if(currentPage<totalPages-1){
        currentPage++;
        // 切页时自动收起子任务列，防止索引错误
        expandedColumnIdx=null;
        expandedCellIdx=null;
        renderTable();
    }
}
function prevPage(){
    if(currentTaskFilter!==null) return;
    if(currentPage>0){
        currentPage--;
        expandedColumnIdx=null;
        expandedCellIdx=null;
        renderTable();
    }
}
function updatePaginationInfo(){
    const pageInfo=document.getElementById('pageInfo');
    const totalPages=Math.ceil(tasks.length/tasksPerPage);
    pageInfo.textContent=`第 ${currentPage+1} / ${totalPages} 页`;

    // 按钮可用性
    const prevBtn=document.querySelector('.prev-page-btn');
    const nextBtn=document.querySelector('.next-page-btn');
    if(currentTaskFilter!==null){
        prevBtn.disabled=true;
        nextBtn.disabled=true;
    }else{
        prevBtn.disabled = currentPage===0;
        nextBtn.disabled = currentPage>=totalPages-1;
    }
}

/* -------------------- 结束 -------------------- */
</script>
</body>
</html>
